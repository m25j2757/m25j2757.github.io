<!DOCTYPE html>
<html>
<head>
  <title>Ultimate Student Financial Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Segoe UI', Arial; background: #f0f4f8; margin: 0; padding: 20px; text-align: center; }
    h1 { color: #2a9d8f; margin-bottom: 20px; }

    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 10px auto;
      max-width: 600px;
    }

    input, select, button { padding: 10px; margin: 5px; border-radius: 6px; border: 1px solid #ccc; }
    button { cursor: pointer; transition: 0.3s; }
    .dapat { background: #2a9d8f; color: #fff; border: none; }
    .dapat:hover { background: #21867a; }
    .belanja { background: #e76f51; color: #fff; border: none; }
    .belanja:hover { background: #c74b3a; }
    .reset, .csv { background: #264653; color: #fff; border: none; }
    .reset:hover, .csv:hover { background: #1e333f; }

    #balance { font-weight: bold; font-size: 1.5em; margin: 20px 0; }

    ul { list-style: none; padding: 0; max-width: 600px; margin: 0 auto; }
    li { border-radius: 8px; padding: 10px; margin: 5px 0; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05); transition: transform 0.2s; }
    li:hover { transform: scale(1.02); }

    .incoming { background-color: #d4edda; color: #155724; }
    .outgoing { background-color: #f8d7da; color: #721c24; }
    .date { font-size: 0.8em; color: #555; margin-left: 10px; }
    button.delete { margin-left: 10px; background: #721c24; color: #fff; }

    canvas { max-width: 600px; margin: 30px auto; display: block; }
  </style>
</head>
<body>

<h1>Ultimate Student Financial Tracker</h1>

<div class="card">
  <input type="text" id="desc" placeholder="Catatan">
  <input type="number" id="amount" placeholder="Jumlah (RM)">
  <select id="category">
    <option value="Makan">Makan</option>
    <option value="Transport">Transport</option>
    <option value="Hiburan">Hiburan</option>
    <option value="Lain-lain">Lain-lain</option>
  </select>
  <button class="dapat" onclick="addTransaction('incoming')">Dapat Duit</button>
  <button class="belanja" onclick="addTransaction('outgoing')">Belanja</button>
</div>

<div class="card" id="balance">Baki: RM 0</div>

<div class="card">
  <label>Filter Kategori:</label>
  <select id="filterCategory" onchange="filterCategory()">
    <option value="All">All</option>
    <option value="Makan">Makan</option>
    <option value="Transport">Transport</option>
    <option value="Hiburan">Hiburan</option>
    <option value="Lain-lain">Lain-lain</option>
  </select>
  <button class="reset" onclick="resetAll()">Reset All</button>
  <button class="csv" onclick="downloadCSV()">Download CSV</button>
</div>

<ul id="list"></ul>

<div class="card">
  <h3>Graf Pie Kategori</h3>
  <canvas id="pieChart"></canvas>
</div>

<div class="card">
  <h3>Graf Bar Mingguan & Bulanan</h3>
  <canvas id="barChart"></canvas>
</div>

<script>
let balance = 0;
let transactions = JSON.parse(localStorage.getItem("transactions") || "[]");
let list = document.getElementById("list");
let filter = "All";
let pieChart, barChart;

window.onload = function() {
  renderList();
  updateBalance();
  updateCharts();
}

function addTransaction(type) {
  let desc = document.getElementById("desc").value;
  let amount = parseFloat(document.getElementById("amount").value);
  let category = document.getElementById("category").value;

  if(!desc || isNaN(amount)) { alert("Sila isi semua"); return; }
  if(type === 'outgoing') amount = -Math.abs(amount);

  let date = new Date().toISOString(); // simpan ISO untuk graf
  let transaction = {desc, amount, category, date, type};
  transactions.push(transaction);
  localStorage.setItem("transactions", JSON.stringify(transactions));

  renderList();
  updateBalance();
  updateCharts();

  document.getElementById("desc").value = "";
  document.getElementById("amount").value = "";
}

function renderList() {
  list.innerHTML = '';
  transactions.filter(t => filter === "All" || t.category === filter).forEach(item => {
    let li = document.createElement("li");
    li.className = item.amount >= 0 ? 'incoming' : 'outgoing';
    let dateDisplay = new Date(item.date).toLocaleString();
    li.innerHTML = `${item.desc}: RM ${item.amount.toFixed(2)} (${item.category}) <span class="date">${dateDisplay}</span>`;

    let btn = document.createElement("button");
    btn.textContent = "Delete";
    btn.className = "delete";
    btn.onclick = function() { deleteTransaction(item); };

    li.appendChild(btn);
    list.appendChild(li);
  });
}

function deleteTransaction(item) {
  transactions = transactions.filter(t => t !== item);
  localStorage.setItem("transactions", JSON.stringify(transactions));
  renderList();
  updateBalance();
  updateCharts();
}

function updateBalance() {
  balance = transactions.reduce((sum, t) => sum + t.amount, 0);
  document.getElementById("balance").textContent = "Baki: RM " + balance.toFixed(2);
}

function updateCharts() {
  // Pie chart kategori
